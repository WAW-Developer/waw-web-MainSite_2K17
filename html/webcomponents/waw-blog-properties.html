<dom-module id="waw-blog-properties">
  <template>
    <style>
      /* local styles go here */
      :host {
        display: block;
      }
    </style>
   
    <!-- local DOM goes here -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Blog properties</h3>
      </div>
      <div class="panel-body">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a href="#categories" aria-controls="categories" role="tab" data-toggle="tab">Categories</a></li>
          <li role="presentation"><a href="#search" aria-controls="search" role="tab" data-toggle="tab">Search</a></li>
          <li role="presentation"><a href="#properties" aria-controls="properties" role="tab" data-toggle="tab">Properties</a></li>
        </ul>
      
        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="categories">
          
          <!-- Panel Toolbar -->
          <nav class="nav nav-pills">
              <span class="glyphicon glyphicon-tags" aria-hidden="true" style="margin-right: 6px;"> </span>
              <span>Categories <span class="badge small">{{data.topic._model._rss.categories.length}}</span></span>
              
              
            <button type="button" 
              class="btn btn-default navbar-btn"
              on-click="_orderCategories"
              data-order="name">
              <span class="glyphicon glyphicon-sort-by-alphabet" aria-hidden="true"></span>
            </button>

            <button type="button" 
              class="btn btn-default navbar-btn"
              on-click="_orderCategories"
              data-order="count">
              <span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>
            </button>
            
          </nav>
          <!-- EnfOf Panel Toolbar -->

          
          
          <template id="categories_list" is="dom-repeat" items="{{categories}}" as="_category" index-as="_catagory_no">
            
<!--             <a href="javascript:void(null);"> -->
<!--             <span class="label label-default">{{_category.name}}<span class="badge">{{_category.posts.length}}</span></span> -->
<!--             </a> -->
            
            <button class$="btn {{_category_Class(_category._model._selected)}}" type="button" 
                on-click="_clickcategory">
              {{_category.name}} <span class="badge">{{_category.posts.length}}</span>
            </button>
            
          </template>
          
          
          </div>
          <div role="tabpanel" class="tab-pane" id="search">... Search</div>
          <div role="tabpanel" class="tab-pane" id="properties">
        ... Properties
            <ul class="list-group">
              <li class="list-group-item"><strong>Name:</strong> {{data.topic.name}}</li>
              <li class="list-group-item"><strong>Description:</strong> {{data.topic.description}}</li>
              <li class="list-group-item"><strong>URL main:</strong> {{data.topic.url_main}}</li>
              <li class="list-group-item"><strong>URL blog:</strong> {{data.topic.url_blog}}</li>
            </ul>

          </div>
        </div>
        
        
      </div>
    </div>
  
  </template>
  
   <script>
   Polymer({
     /* this is the element's prototype */
    is: 'waw-blog-properties',
    
    
    properties: {

      mode: {
        type: String,
        value: 'auto'
      },

      data: {
        type: Object,
        reflectToAttribute: true,
        notify: true,
        value: function() { return {}; }
      },
      
      
      categories: {
          type: Array,
          reflectToAttribute: true,
          notify: true,
          value: function() { return []; }

      },

    },
    
    /**
     * Called when the component is ready
     */
    ready: function() {
//         console.log(this.localName + '#' + this.id + ' has local DOM initialized'); //// TODO: REMOVE DEBUG LOG
      },
      
      
    _category_Class: function(_selected) {

        return (_selected === true) ? 'bg-success' : 'btn-link';
        
    },  // EndOf _category_Class
      
    
    set_topic: function (_options) {
          
      var _this = this;
      
      // Check options
      _options = (_options === undefined) ? {} : _options;
      
      // Check options.topic
      var _topic = (_options.topic !== undefined) ? _options.topic : _this.get('data.topic');

      _this.set('data.topic', {});
      _this.set('data.topic', _topic);

      // Refresh categories
      _this.set_categories({
          'categories': _topic._model._rss.categories
      });
      
      _this._orderCategories();
      
//       var _data = _this.data;
//       console.log('waw-blog-properties set_topic'); /// TODO: REMOVE DEBUG LOG
//       console.log(_data); // TODO: REMOVE DEBUG LOG

    },   // EndOf set_topic
   
    set_categories: function (_options) {
        
        var _this = this;
        
        // Check options
        _options = (_options === undefined) ? {} : _options;
        
        // Check options.categories
        var _categories = (_options.categories !== undefined) ? _options.categories : _this.get('categories');

        // clear an array and add new values
        _this.set('categories', []);
        _this.$.categories_list.render();

        
        _categories.forEach(function(_item, _i){
            
            _item._model = (_item._model !== undefined) ? _item._model : {};
            _item._model._selected = (_item._model._selected !== undefined) ? _item._model._selected : false;

            _this.push('categories', _item);
        });
        
        
    },  // EndOf set_categories

    
    
    _orderCategories: function(_event) {
        
        var _this = this;
        var _data = _this.data;

//         var _rss = _this.get('data.topic._model._rss');
//         var _categories = _rss.categories;
        
        var _categories = _this.get('categories');

        
        var _JQ = jQuery;
        
        var _orderType = "count"
        if (_event !== undefined && _event.srcElement !== undefined) {
            _orderType = _JQ(_event.srcElement).closest('button').attr('data-order');
        } else if (_event !== undefined && _event.orderType !== undefined) {
            _orderType = _event.orderType;
        } else if (_data._orderType !== undefined) {
            _orderType = _data._orderType;
        }
        
        _data._orderType = _orderType;
        
        
        switch(_orderType) {
        
          case "name":
              _categories.sort(function(a, b) {
                if (a.name < b.name) return -1;
                if (a.name > b.name) return 1;
                return 0;
            });
            break;
                
          case "count":
              _categories.sort(function(a, b) {
                if (a.count > b.count) return -1;
                if (a.count < b.count) return 1;
                return 0;
            });
            break;
              
          default:
              break;
        }

        _this.set_categories({
            'categories': _categories
        });
        
    },   // EndOf orderCategories
    
    
    _clickcategory: function(_event) {
        
        var _this = this;

        var _category = _event.model.__data__._category;

        _category._model = (_category._model === undefined) ? {} : _category._model;

        var _JQ = jQuery;
        
        var _button = _JQ(_event.srcElement).closest('button');
        
        if (_category._model._selected !== true) {
            
            _JQ(_button).removeClass( 'btn-link' );
            _JQ(_button).addClass( 'bg-success' );
            _category._model._selected = true;
            
        } else {
            
            _JQ(_button).removeClass( 'bg-success' );
            _JQ(_button).addClass( 'btn-link' );
            _category._model._selected = false;
        }
        
        
        _this.fire('catepgoryclicked', {
            'category': _category
            });
        
        
    },   // EndOf _clickcategory
    
  });
  </script>
  
  
</dom-module>